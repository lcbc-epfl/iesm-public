
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9.2. Locating Transition States: Constrained Optimisations &#8212; Introduction to Electronic Structure Methods</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Coupled cluster" href="../../Lecture/CC.html" />
    <link rel="prev" title="9.1. Theory" href="Ex8Theory.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      <h1 class="site-logo" id="site-title">Introduction to Electronic Structure Methods</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Introduction to Electronic Structure Methods
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex1.html">
   1. Linear Algebra in Quantum Mechanics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/Ex1Theory.html">
     1.1. Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/Ex1Exercises.html">
     1.2. Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex1/Ex1.html">
     1.3. Working with vectors using Numpy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex2.html">
   2. Hartree-Fock Calculations in
   <em>
    Psi4
   </em>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex2/Ex2.html">
     2.1. Basis Sets - Defining Vector Spaces
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex3.html">
   3. Large Basis Sets, Dissociation Energy and Geometry Optimisation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/Ex3.html">
     3.1. Effects of Basis Set Size: The Molecular Case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/Ex3Diss.html">
     3.2. Recording a Dissociation Curve for H
     <span class="math notranslate nohighlight">
      \(_2\)
     </span>
     : RHF vs. UHF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex3/Ex3GeoOpt.html">
     3.3. Geometry optimization of
     <span class="math notranslate nohighlight">
      \(H_2O\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex4.html">
   4. Post-Hartree Fock Methods: MPn and Configuration Interaction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/Ex4Theory.html">
     4.1. MÃ¸ller-Plesset Perturbation Theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/BDE.html">
     4.2. Homolytic Cleavage of the C-F Bond
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/HNO3_Correlation.html">
     4.5. Correlation energy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex4b.html">
   5. The hartree fock procedure in detail
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex4/HF_student.html">
     5.1. Hartree-Fock Procedure for Approximate Quantum Chemistry
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Ex5.html">
   6. Density Functional Theory - Comparison with (Post) Hartree-Fock Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex5/Ex5.html">
     6.1. Testing DFT functionals on an aldol reaction.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex5/Ex5b.html">
     6.2. Density Functional Theory 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex6.html">
   7. Troubleshooting, Pitfalls, Traps
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex6/Ex6.html">
     7.1. Fixing errors in the calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex6/Ex6_DFT_Hard_Easy.html">
     7.2. Hard and easy cases for DFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex6/Ex6_DFT_integration_grid.html">
     7.3. Integration grids
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ex7.html">
   8. Potential Energy Scans and Visualisation of Trajectories
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Ex7/Ex7.html">
     8.1. Potential Energy Scans and Visualisation of Trajectories
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../ex8.html">
   9. Finding Transition States and Barrier Heights: First Order Saddle Points
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Ex8Theory.html">
     9.1. Theory
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     9.2. Locating Transition States: Constrained Optimisations
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lecture
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Lecture/CC.html">
   Coupled cluster
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/Exercises/Ex8/Ex8.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lcbc-epfl/iesm-public"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lcbc-epfl/iesm-public/issues/new?title=Issue%20on%20page%20%2FExercises/Ex8/Ex8.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        <a class="jupyterhub-button" href="https://noto.epfl.ch/hub/user-redirect/git-pull?repo=https://github.com/lcbc-epfl/iesm-public&urlpath=lab/tree/iesm-public/iesm/Exercises/Ex8/Ex8.ipynb&branch=deploy"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   9.2. Locating Transition States: Constrained Optimisations
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#constructing-a-guess">
     9.2.1. Constructing a Guess
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#constrained-optimization">
     9.2.2. Constrained optimization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-the-transition-state">
     9.2.3. Finding the Transition State
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recording-a-potential-energy-profile-the-intrinsic-reaction-coordinate-irc">
   9.3. Recording a Potential Energy Profile: The Intrinsic Reaction Coordinate (IRC)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#backward">
     9.3.1. Backward
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forward">
     9.3.2. Forward
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#irc">
     9.3.3. IRC
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="locating-transition-states-constrained-optimisations">
<h1><span class="section-number">9.2. </span>Locating Transition States: Constrained Optimisations<a class="headerlink" href="#locating-transition-states-constrained-optimisations" title="Permalink to this headline">Â¶</a></h1>
<p>Unlike a geometry optimisation, a transition state search requires more
than just <em>some</em> guess. Finding the transition state from a reactant or
a product structure will be computationally unfeasible, as those
structures are given by local minima on the PES. Hence, all possible
paths originating from these minima will go uphill (recall the
mathematical definition of a minimum with respect to its derivatives),
and it cannot be clear in advance which paths will actually connect
reactants and products, or which path(s) will proceed <em>via</em> the lowest
lying transition state. Instead, one needs a guess that is reasonably
close to the real transition state, such that the <em>curvature</em> of the
potential energy surface close to the TS is known, making it possible to
proceed uphill along the reaction coordinate until the transition state
is reached. The general procedure for a transition state search includes
the construction of a guess geometry that should be reasonably close to
the expected TS, followed by a <em>constrained optimisation</em> (<em>cf.</em> figure
3).</p>
<div class="figure align-default" id="tssearch">
<img alt="../../_images/miniumenergypath.png" src="../../_images/miniumenergypath.png" />
<p class="caption"><span class="caption-number">Fig. 9.3 </span><span class="caption-text">Finding a transition state from an initial guess by performing a
constrained optimisation followed by a TS
search.</span><a class="headerlink" href="#tssearch" title="Permalink to this image">Â¶</a></p>
</div>
<p>In a constrained optimisation, all degrees of freedom which are not
deemed relevant for the reaction are relaxed, whereas the relevant
degree(s) of freedom is (are) kept fixed. After the optimisation, the
curvature of the PES is evaluated at the chosen geometry (either
analytically or numerically, <em>cf.</em> the following section). If the
constrained degree(s) of freedom was (were) suitably chosen, the paths
associated to the unconstrained N-1 degrees of freedom will go uphill in
both directions, indicating that the corresponding structural parameters
were properly relaxed. There should be one degree of freedom remaining
that is associated to a path that goes downhill on one side and uphill
on the other side: This will be the path that leads uphill to the
transition state. As the associated degree of freedom is then known, the
geometry can then be optimised to a transition state by selectively
âwalking uphillâ along this specific path.</p>
<div class="section" id="constructing-a-guess">
<h2><span class="section-number">9.2.1. </span>Constructing a Guess<a class="headerlink" href="#constructing-a-guess" title="Permalink to this headline">Â¶</a></h2>
<p>You can find below the Z-matrix for the chloropropanoate (2-Chloro-1-propanol) already set, obtained using the Open Source Software <a class="reference external" href="https://avogadro.cc/">Avogadro</a>. We want to set the Z-matrix for the transition state editing this matrix. Correct the parameters adapting the conformation to be reasonably close to the transition state: for the TS, one expects that the C-Cl bond will already be elongated, whereas the oxygen atom will start to form the epoxide ring. Change the bond angle of the oxygen atom to something smaller than the original value, such as 80â¦, and modify the bond length for the C-Cl bond to an elongated conformation, such as 2.40 Ã. Moreover, you need to delete the hydrogen bond to the oxygen atom, and edit the Z-matrix accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">psi4</span>
<span class="kn">import</span> <span class="nn">py3Dmol</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_memory</span><span class="p">(</span><span class="s1">&#39;2 GB&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">helpers</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Z-matrix for the chloropropanoate</span>
<span class="n">chloropropanoate</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">0 1</span>
<span class="s2"> symmetry c1</span>
<span class="s2"> c</span>
<span class="s2"> c    1 cc2</span>
<span class="s2"> cl   1 clc3        2 clcc3</span>
<span class="s2"> h    1 hc4         2 hcc4          3 dih4</span>
<span class="s2"> c    1 cc5         2 ccc5          3 dih5</span>
<span class="s2"> o    2 oc6         1 occ6          3 dih6</span>
<span class="s2"> h    2 hc7         1 hcc7          6 dih7</span>
<span class="s2"> h    2 hc8         1 hcc8          6 dih8</span>
<span class="s2"> h    5 hc9         1 hcc9          2 dih9</span>
<span class="s2"> h    5 hc10        1 hcc10         9 dih10</span>
<span class="s2"> h    5 hc11        1 hcc11         9 dih11</span>
<span class="s2"> h    6 ho          2 hoc2          1 dih12</span>
<span class="s2"> </span>
<span class="s2">cc2     =    1.500000</span>
<span class="s2">clc3    =    1.790000 </span>
<span class="s2">clcc3   =    109.471</span>
<span class="s2">hc4     =    1.089000</span>
<span class="s2">hcc4    =    109.471</span>
<span class="s2">dih4    =    100.000</span>
<span class="s2">cc5     =    1.500000</span>
<span class="s2">ccc5    =    109.471</span>
<span class="s2">dih5    =   -100.000</span>
<span class="s2">oc6     =    1.430000</span>
<span class="s2">occ6    =    110.600  </span>
<span class="s2">dih6    =    180.000</span>
<span class="s2">hc7     =    1.070000</span>
<span class="s2">hcc7    =    109.471</span>
<span class="s2">dih7    =    120.000</span>
<span class="s2">hc8     =    1.070000</span>
<span class="s2">hcc8    =    109.471</span>
<span class="s2">dih8    =    240.000</span>
<span class="s2">hc9     =    1.070000</span>
<span class="s2">hcc9    =    109.471</span>
<span class="s2">dih9    =    180.000</span>
<span class="s2">hc10    =    1.070000</span>
<span class="s2">hcc10   =    109.471</span>
<span class="s2">dih10   =    120.000</span>
<span class="s2">hc11    =    1.070000</span>
<span class="s2">hcc11   =    109.471</span>
<span class="s2">dih11   =    240.000</span>
<span class="s2">ho      =    0.97       </span>
<span class="s2">hoc2    =    109.471    </span>
<span class="s2">dih12   =    180.0      </span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1">#Edit the Z-matrix to obtain the TS guess accordin to the requests above</span>
<span class="n">ts_guess</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">0 1</span>
<span class="s2"> symmetry c1</span>
<span class="s2"> c</span>
<span class="s2"> c    1 cc2</span>
<span class="s2"> cl   1 clc3        2 clcc3</span>
<span class="s2"> h    1 hc4         2 hcc4          3 dih4</span>
<span class="s2"> c    1 cc5         2 ccc5          3 dih5</span>
<span class="s2"> o    2 oc6         1 occ6          3 dih6</span>
<span class="s2"> h    2 hc7         1 hcc7          6 dih7</span>
<span class="s2"> h    2 hc8         1 hcc8          6 dih8</span>
<span class="s2"> h    5 hc9         1 hcc9          2 dih9</span>
<span class="s2"> h    5 hc10        1 hcc10         9 dih10</span>
<span class="s2"> h    5 hc11        1 hcc11         9 dih11</span>
<span class="s2"> h    6 ho          2 hoc2          1 dih12</span>
<span class="s2"> </span>
<span class="s2">cc2     =    1.500000</span>
<span class="s2">clc3    =    1.790000 </span>
<span class="s2">clcc3   =    109.471</span>
<span class="s2">hc4     =    1.089000</span>
<span class="s2">hcc4    =    109.471</span>
<span class="s2">dih4    =    100.000</span>
<span class="s2">cc5     =    1.500000</span>
<span class="s2">ccc5    =    109.471</span>
<span class="s2">dih5    =   -100.000</span>
<span class="s2">oc6     =    1.430000</span>
<span class="s2">occ6    =    110.600  </span>
<span class="s2">dih6    =    180.000</span>
<span class="s2">hc7     =    1.070000</span>
<span class="s2">hcc7    =    109.471</span>
<span class="s2">dih7    =    120.000</span>
<span class="s2">hc8     =    1.070000</span>
<span class="s2">hcc8    =    109.471</span>
<span class="s2">dih8    =    240.000</span>
<span class="s2">hc9     =    1.070000</span>
<span class="s2">hcc9    =    109.471</span>
<span class="s2">dih9    =    180.000</span>
<span class="s2">hc10    =    1.070000</span>
<span class="s2">hcc10   =    109.471</span>
<span class="s2">dih10   =    120.000</span>
<span class="s2">hc11    =    1.070000</span>
<span class="s2">hcc11   =    109.471</span>
<span class="s2">dih11   =    240.000</span>
<span class="s2">ho      =    0.97       </span>
<span class="s2">hoc2    =    109.471    </span>
<span class="s2">dih12   =    180.0 </span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawXYZSideBySide_labeled</span><span class="p">(</span><span class="n">chloropropanoate</span><span class="p">,</span> <span class="n">ts_guess</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_16287812982446342"  style="position: relative; width: 640px; height: 480px">
        <p id="3dmolwarning_16287812982446342" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://3dmol.org/build/3Dmol.js');
}

var viewer_16287812982446342 = null;
var warn = document.getElementById("3dmolwarning_16287812982446342");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
var viewergrid_16287812982446342 = null;
viewergrid_16287812982446342 = $3Dmol.createViewerGrid($("#3dmolviewer_16287812982446342"),{rows: 1, cols: 2, control_all: true},{backgroundColor:"white"});
viewer_16287812982446342 = viewergrid_16287812982446342[0][0];
viewergrid_16287812982446342[0][0].zoomTo();viewergrid_16287812982446342[0][1].zoomTo();	viewergrid_16287812982446342[0][0].addModel("12\n\n C    0.222358902508   -0.353606380052   -0.294378928442\n C    0.222358902508   -0.353606380052    1.205621071558\nCL    0.222358902508    1.334024102010   -0.891039096389\n H    1.233481156049   -0.531894514146   -0.657374974751\n C   -1.170371474270   -0.599182322331   -0.794373482587\n O    0.222358902508   -1.692171516159    1.708754628777\n H    1.096011433538    0.150797143916    1.562283853515\n H   -0.651293628522    0.150797143916    1.562283853515\n H   -1.170371474270   -0.599182322331   -1.864373482587\n H   -1.515398395040   -1.547149907082   -0.437702931232\n H   -1.818814734895    0.173609664912   -0.437702931232\n H    0.222358902508   -1.673059128797    2.678566320111\n","xyz");
	viewergrid_16287812982446342[0][0].addLabel("0",{"position": {"x": 0.22235890250849727, "y": -0.35360638005327316, "z": -0.2943789284427553}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("1",{"position": {"x": 0.22235890250849727, "y": -0.35360638005327316, "z": 1.2056210715606743}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("2",{"position": {"x": 0.22235890250849727, "y": 1.3340241020129557, "z": -0.8910390963906087}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("3",{"position": {"x": 1.2334811560514378, "y": -0.5318945141476388, "z": -0.6573749747529298}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("4",{"position": {"x": -1.1703714742724125, "y": -0.5991823223320136, "z": -0.7943734825890012}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("5",{"position": {"x": 0.22235890250849727, "y": -1.6921715161630655, "z": 1.7087546287805488}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("6",{"position": {"x": 1.0960114335404842, "y": 0.15079714391624185, "z": 1.56228385351833}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("7",{"position": {"x": -0.651293628523489, "y": 0.15079714391624277, "z": 1.56228385351833}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("8",{"position": {"x": -1.1703714742724125, "y": -0.5991823223320135, "z": -1.8643734825914484}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("9",{"position": {"x": -1.5153983950430838, "y": -1.547149907085861, "z": -0.43770293123284804}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("10",{"position": {"x": -1.8188147348986956, "y": 0.17360966491221708, "z": -0.4377029312328472}, "inFront": true});
	viewergrid_16287812982446342[0][0].addLabel("11",{"position": {"x": 0.22235890250849727, "y": -1.6730591288011394, "z": 2.678566320117393}, "inFront": true});
	viewergrid_16287812982446342[0][1].addModel("11\n\n C    0.224768290094   -0.575970360166   -0.059683739329\n C    0.224768290094   -0.575970360166    1.440316260671\nCL    0.224768290094    1.686774420253   -0.859675025962\n H    1.235890543635   -0.754258494259   -0.422679785639\n C   -1.167962086684   -0.821546302444   -0.559678293475\n O    0.224768290094   -1.984245446973    1.191999366607\n H    1.098420821124   -0.071566836197    1.796979042627\n H   -0.648884240936   -0.071566836197    1.796979042627\n H   -1.167962086684   -0.821546302444   -1.629678293475\n H   -1.512989007454   -1.769513887195   -0.203007742119\n H   -1.816405347309   -0.048754315201   -0.203007742119\n","xyz");
	viewergrid_16287812982446342[0][1].addLabel("0",{"position": {"x": 0.22476829009438942, "y": -0.5759703601668448, "z": -0.05968373932955492}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("1",{"position": {"x": 0.22476829009438942, "y": -0.5759703601668448, "z": 1.4403162606738749}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("2",{"position": {"x": 0.22476829009438942, "y": 1.686774420257149, "z": -0.8596750259635483}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("3",{"position": {"x": 1.2358905436373302, "y": -0.7542584942612103, "z": -0.4226797856397294}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("4",{"position": {"x": -1.1679620866865206, "y": -0.8215463024455855, "z": -0.5596782934758008}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("5",{"position": {"x": 0.22476829009438942, "y": -1.9842454469775224, "z": 1.191999366609597}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("6",{"position": {"x": 1.0984208211263762, "y": -0.07156683619732974, "z": 1.7969790426315304}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("7",{"position": {"x": -0.6488842409375969, "y": -0.07156683619732887, "z": 1.7969790426315304}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("8",{"position": {"x": -1.1679620866865206, "y": -0.8215463024455852, "z": -1.6296782934782479}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("9",{"position": {"x": -1.5129890074571914, "y": -1.7695138871994327, "z": -0.20300774211964764}, "inFront": true});
	viewergrid_16287812982446342[0][1].addLabel("10",{"position": {"x": -1.8164053473128035, "y": -0.04875431520135457, "z": -0.20300774211964684}, "inFront": true});
	viewergrid_16287812982446342[0][0].setStyle({"stick": {}});
	viewergrid_16287812982446342[0][1].setStyle({"stick": {}});
	viewergrid_16287812982446342[0][0].setStyle({"model": 0},{"stick": {"colorscheme": "yellowCarbon"}, "sphere": {"scale": 0.1}});
	viewergrid_16287812982446342[0][1].setStyle({"model": 0},{"stick": {"colorscheme": "yellowCarbon"}, "sphere": {"scale": 0.1}});
	viewergrid_16287812982446342[0][0].zoomTo();
	viewergrid_16287812982446342[0][1].zoomTo();
viewergrid_16287812982446342[0][1].render();
viewergrid_16287812982446342[0][0].render();
});
</script></div></div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 3</p>
<p>Include a screenshot of the transition state that you obtained and the corresponding Z-matrix for the transition state guess</p>
</div>
</div>
<div class="section" id="constrained-optimization">
<h2><span class="section-number">9.2.2. </span>Constrained optimization<a class="headerlink" href="#constrained-optimization" title="Permalink to this headline">Â¶</a></h2>
<p>We will first optimize our transition state guess keeping the C-Cl distance fixed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_guess_opt</span> <span class="o">=</span> <span class="n">ts_guess</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;poxide.log&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span><span class="s2">&quot;frozen_distance&quot;</span><span class="p">:</span><span class="s2">&quot;1 3&quot;</span><span class="p">})</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">ts_guess_opt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimizer: Optimization complete!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-653.2420085847897
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawXYZSideBySide_labeled</span><span class="p">(</span><span class="n">ts_guess</span><span class="p">,</span> <span class="n">ts_guess_opt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="finding-the-transition-state">
<h2><span class="section-number">9.2.3. </span>Finding the Transition State<a class="headerlink" href="#finding-the-transition-state" title="Permalink to this headline">Â¶</a></h2>
<p>Now that we have our  transition state guess optimized, we want to find out whether this guess is close to the transition state (meaning it has one imaginary frequency) and then optimize to the actual transition state.</p>
<p>If we set <code class="docutils literal notranslate"><span class="pre">full_hess_every</span></code> to <code class="docutils literal notranslate"><span class="pre">0</span></code>, a frequency calculation will be performed at the begining (you could also do it seperately using <code class="docutils literal notranslate"><span class="pre">psi4.frequency([..])</span></code>. By setting <code class="docutils literal notranslate"><span class="pre">opt_type</span></code> to <code class="docutils literal notranslate"><span class="pre">ts</span></code> the optimization will try to find the 1st order saddlepoint that is the transition state.</p>
<p>We will write the normal modes to a file for visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts_guess_opt</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean_options</span><span class="p">()</span>

<span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ts.log&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span>
    <span class="s2">&quot;opt_type&quot;</span><span class="p">:</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;geom_maxiter&quot;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span> 
    <span class="s2">&quot;normal_modes_write&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;full_hess_every&quot;</span><span class="p">:</span><span class="mi">0</span> <span class="c1">#0 compute the initial Hessian only</span>
    <span class="p">})</span>

<span class="n">E</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">save_string_xyz_file</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can also compare the TS with the guess to see how far we are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawXYZSideBySide_labeled</span><span class="p">(</span><span class="n">ts_guess_opt</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 4</p>
<p>Take a screenshot of the optimised transition state structure. How did the structure change with respect to the constrained-optimised guess?</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Solution</p>
<p>Increased Cl-C distance (fixed during guess optimization) and C-C-O angle increased, resulting in a structure more symilar to the reagent than to the product.</p>
</div>
<p>We can now have a look at the normal model that we obtained, for that we need to first check how the file is named. Then you can visualize one normal mode at time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check how the file is named</span>
<span class="o">!</span>ls -lrth ts.*.molden_normal_modes 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-rw-r--r-- 1 anlevy software 21K Aug 12 17:26 ts.default.14947.molden_normal_modes
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># be sure to use the right file in the show_normal_modes</span>

<span class="n">show_normal_modes</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;NAMEOF.molden_normal_modes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 4</p>
<p>Report the value of the negative frequency that you obtain.  What motion is this mode related to?
What motions are associated with low and high vibrational frequencies? Choose two positive vibrational modes and desribe their particular associated motion.</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 5</p>
<p>Is the transition state you predicted an early or a late transition state? What about the guess?</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 6</p>
<p>Having found a transition state, how would you now obtain the barrier height for your reaction? Are there ways of verifying whether you have found a meaningful
transition state? <strong>Bonus:</strong> How would you define âmeaningfulâ in
this context?</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Solution</p>
<p>From the TS it is necessary to find a minimum energy reaction path on the PES joining the reactants with the TS and the TS with the products.</p>
<p>TS corresponds to a saddle point of the PES, this can be verified through the  eigenvalues of the Hessian matrix. The TS found should be a maximum of the PES over the reaction coordinate.</p>
<p><strong>Bonus:</strong> A TS state can be defined meaningful if it is not too far from reactant and products and it is energetically feasible.</p>
</div>
<p>Lets check again that our TS is a good one by performing a frequency calculation.
We will save the wave function as well because we want to use the hessian to speed up our IRC search.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean_options</span><span class="p">()</span>
<span class="n">E</span><span class="p">,</span> <span class="n">wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">return_wfn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="recording-a-potential-energy-profile-the-intrinsic-reaction-coordinate-irc">
<h1><span class="section-number">9.3. </span>Recording a Potential Energy Profile: The Intrinsic Reaction Coordinate (IRC)<a class="headerlink" href="#recording-a-potential-energy-profile-the-intrinsic-reaction-coordinate-irc" title="Permalink to this headline">Â¶</a></h1>
<p>A transition state search merely guarantees that one reaches a
first-order saddle point on the PES; there is, however, no guarantee
that it is really linked to the reactant and product. (For instance,
there may be further transition states lying in between.) Although the
visualisation of the imaginary vibrational mode may give some hint as to
whether one has found a reasonable saddle point, this information is not
sufficient to guarantee a connection to the reactant and product well.
Following the negative Hessian eigenvalues from the transition state to
the next local minimum, on the other hand, will immediately reveal
whether such a connection exists. This Hessian-following in
mass-weighted coordinates is referred to as a search along the
<em>Intrinsic Reaction Coordinate</em> (IRC). This search will create a
potential energy profile for the reaction, as well as a trajectory that
visualises the lowest energy path from reactant to TS to product.</p>
<p>You will verify whether the transition state
you computed is the proper state that connects your
starting material to the product, and you will build the reaction
profile and visualize it.</p>
<p>As Psi4 updates the molecule geometry when optimizing we make two copies for the product and reactant and then we use <code class="docutils literal notranslate"><span class="pre">irc</span></code> to follow the intrinsic reaction coordinate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backward</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">forward</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean_options</span><span class="p">()</span>
<span class="n">E_b</span><span class="p">,</span> <span class="n">wfn_b</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">backward</span><span class="p">,</span> <span class="n">return_wfn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="backward">
<h2><span class="section-number">9.3.1. </span>Backward<a class="headerlink" href="#backward" title="Permalink to this headline">Â¶</a></h2>
<p>First, letâs optimize towards the reactant</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;irc_backward.log&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span>
     <span class="s2">&quot;geom_maxiter&quot;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span>
     <span class="s2">&quot;full_hess_every&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="c1">#-1</span>
     <span class="s2">&quot;opt_type&quot;</span><span class="p">:</span><span class="s2">&quot;irc&quot;</span><span class="p">,</span>
     <span class="s2">&quot;irc_step_size&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span>
     <span class="s2">&quot;ensure_bt_convergence&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
<span class="c1">#     &quot;cart_hess_read&quot;:True,</span>
     <span class="s2">&quot;irc_direction&quot;</span><span class="p">:</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span>
     <span class="p">})</span>

<span class="n">E</span><span class="p">,</span> <span class="n">history_backward</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span><span class="n">molecule</span><span class="o">=</span><span class="n">backward</span><span class="p">,</span> <span class="n">return_history</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#, ref_gradient=wfn.gradient())</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">return_history=True</span></code> option indicates to additionally return dictionary of lists of geometries, energies, and gradients at each step in the optimization. We can use this history to follow the optimization along the IRC steps.
Some operations on the arrays are needed in order to properly visualize the PES.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coordinates_backward</span> <span class="o">=</span> <span class="n">history_backward</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<span class="n">energies_backward</span> <span class="o">=</span> <span class="n">history_backward</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>

<span class="n">backward_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">energy</span> <span class="o">*</span> <span class="n">psi4</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">hartree2kcalmol</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energies_backward</span><span class="p">]</span>
<span class="n">backward_e</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># revert the list</span>
<span class="n">backward_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">backward_e</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">backward_e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="forward">
<h2><span class="section-number">9.3.2. </span>Forward<a class="headerlink" href="#forward" title="Permalink to this headline">Â¶</a></h2>
<p>Then, letâs also optimize towards the products</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;irc_forward.log&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span>
     <span class="s2">&quot;geom_maxiter&quot;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span>
     <span class="s2">&quot;full_hess_every&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="c1">#-1</span>
     <span class="s2">&quot;opt_type&quot;</span><span class="p">:</span><span class="s2">&quot;irc&quot;</span><span class="p">,</span>
     <span class="s2">&quot;irc_step_size&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span>
     <span class="s2">&quot;ensure_bt_convergence&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
<span class="c1">#     &quot;cart_hess_read&quot;:True,</span>
     <span class="s2">&quot;irc_direction&quot;</span><span class="p">:</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span>
     <span class="p">})</span>


<span class="n">E</span><span class="p">,</span> <span class="n">history_forward</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="s1">&#39;b3pw91/6-31+G*&#39;</span><span class="p">,</span><span class="n">molecule</span><span class="o">=</span><span class="n">forward</span><span class="p">,</span> <span class="n">return_history</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#, ref_gradient=wfn.gradient())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coordinates_forward</span> <span class="o">=</span> <span class="n">history_forward</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>
<span class="n">energies_forward</span> <span class="o">=</span> <span class="n">history_forward</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>

<span class="n">forward_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">energy</span> <span class="o">*</span> <span class="n">psi4</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">hartree2kcalmol</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">energies_forward</span> <span class="p">]</span>
<span class="n">forward_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forward_e</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">forward_e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">backward_e</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">forward_e</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="irc">
<h2><span class="section-number">9.3.3. </span>IRC<a class="headerlink" href="#irc" title="Permalink to this headline">Â¶</a></h2>
<p>Now we have all the data to obtain the  potential energy profile for the reaction, as well as the trajectory that visualises the lowest energy path from reactant to TS to product.</p>
<p>We can fist have a look at the <em>backward</em> and <em>forward</em> conformations, which correspond to the starting and ending point of the IRC that we performed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drawXYZSideBySide_labeled</span><span class="p">(</span><span class="n">backward</span><span class="p">,</span> <span class="n">forward</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now letâs have a look to the potential energy profile along the IRC steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span>  <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;IRC step&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pot Energy (kcal mol$^{-1}$)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 7</p>
<p>Take a screenshot of the graph of the potential energy profile you
recorded.
Why is the barrier for the epoxide formation so low? Will this be
the overall barrier for the reaction as depicted in the previous section?</p>
</div>
<p>We can have a closer look at the process, focusing on different parameters along the scan. First of all we can observe visually how the conformation changes during the process, then we will try to have a more quantitative understanding of the process,  focusing on meaningful parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coordinates_backward</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates_backward</span> <span class="o">+</span> <span class="n">coordinates_forward</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">mol2traj</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
<span class="n">drawXYZGeomSlider</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 8</p>
<p>Is the stereochemistry at the carbon at which the reaction takes
place retained?</p>
</div>
<p>Letâs have a look at different bond distances involving different atoms in the molecule. You can have a look at the labeled represetnations of the molecule above to understand between which atoms the distances are calculated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_array</span> <span class="o">=</span> <span class="n">coord2traj_array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

<span class="n">bond_length_C0_Cl2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bond_length_C0_O5</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bond_length_C1_O5</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bond_length_C0_C1</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">traj_array</span><span class="p">:</span>
    <span class="n">bond_length_C0_Cl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_bond</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> 
    <span class="n">bond_length_C0_O5</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_bond</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span> 
    <span class="n">bond_length_C1_O5</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_bond</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span> 
    <span class="n">bond_length_C0_C1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_bond</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bond_length_C0_Cl2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bond_length_C0_O5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bond_length_C1_O5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bond_length_C0_C1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;C0-Cl&quot;</span><span class="p">,</span> <span class="s2">&quot;C0-O&quot;</span><span class="p">,</span> <span class="s2">&quot;C1-O&quot;</span><span class="p">,</span> <span class="s2">&quot;C0-C1&quot;</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;IRC step&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;bond [A]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise  9</p>
<p>How do the C-Cl and the two relevant C-O bond lengths change during
the trajectory? Does the C-C bond in the ring contract as the
epoxide is formed? Show a graph depicting the evolution of these
parameters as the reaction progresses.</p>
</div>
<div class="exercise admonition">
<p class="admonition-title">Exercise 10</p>
<p>What is happening to the methyl group as the reaction proceeds? Find
a suitable parameter (angle, dihedral) to describe and characterise
possible changes you observe, change the code below. Explain in your report what atoms you considered and take and include the evolutions of the chosen parameters during the IRC procedure.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Modify the code below, chosing proper atoms to monitor the changes of the methyl group </span>
<span class="n">methyl_angle</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">methyl_dihedral</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">traj_array</span><span class="p">:</span>
    <span class="n">methyl_angle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_angle</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="c1">#], coord[#], coord[#])) </span>
    <span class="n">methyl_dihedral</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_dihedral</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="c1">#], coord[#], coord[#], coord[#])) </span>
    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">methyl_angle</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">methyl_dihedral</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;angle (#-#-#)&quot;</span><span class="p">,</span> <span class="s2">&quot;dihedral (#-#-#-#)&quot;</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;IRC step&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;angle [deg]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "iesm2"
        },
        kernelOptions: {
            kernelName: "iesm2",
            path: "./Exercises/Ex8"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iesm2'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Ex8Theory.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">9.1. </span>Theory</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../../Lecture/CC.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Coupled cluster</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Laboratory of Computational Biochemistry and Chemistry  - Prof. Ursula Roethlisberger<br/>
        
          <div class="extra_footer">
            <div class="container-lg mt-3 footer"> <div class="row"> <div class="col-xl-9 d-flex"> <div class="container"> <div class="row"> <div class="col-6 d-flex" style="justify-content:center"> <a href="https://lcbc.epfl.ch"> Laboratory of Computational Biochemistry and Chemistry</a></li>
</div> <div class="col-6 d-flex" style="justify-content:center"> <ul style="list-style:none"> <li> <a href="https://github.com/lcbc-epfl/iesm-public">GitHub </a> </li> </li> <!--<li> <a href="https://doi.org/10.5281/zenodo.0000000"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.00000000.svg" alt="DOI"></a> </li>--> </ul> </div> </div> </div> </div> <div class="col-xl-3"> <a href="https://epfl.ch"><img src="https://www.epfl.ch/wp/5.5/wp-content/themes/wp-theme-2018/assets/svg/epfl-logo.svg?refresh=now" alt="EPFL Logo" style="padding:5px;height:33px;"></a> </div> </div> </div> <div class="row_footer my-3"> Dual licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution Share Alike 4.0 International</a> (CC BY SA 4.0) and MIT license. (Except where indicated otherwise) </div>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>